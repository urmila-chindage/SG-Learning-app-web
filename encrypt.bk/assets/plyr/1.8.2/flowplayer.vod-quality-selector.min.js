/*!

   VOD quality selector plugin for Flowplayer HTML5

   Copyright (c) 2016-2017, Flowplayer Drive Oy

   Released under the MIT License:
   http://www.opensource.org/licenses/mit-license.php

   Requires Flowplayer HTML5 version 7.x or greater
   v1.0.0-17-g3ed8f1d

*/
!function(){var e=function(e){function t(t,i){return!!e.engines.filter(function(e){return e.canPlay(t,i)})[0]}e(function(i){var l=e.support;if(l.inlineVideo){var s,o=e.extend,a=/(-[0-9]+p)?(\.(mp4|webm|m3u8|ogv|flv|f4v)?)$/i,r=/(\.(mp4|webm|m3u8|ogv|flv|f4v))?$/i,u=/\.?{ext}/,n=/^(https?:)?\/\/[^\/]+\//,c="video/flash",p=!1;i.conf.hlsjs!==!1&&e.engines.forEach(function(e){"hlsjs"===e.engineName&&e.canPlay("application/x-mpegurl",i.conf)&&(p=!0)}),i.on("load",function(e,i,p){if(!i.live){var f=i.conf,y=p.vodQualities||f.vodQualities||{},v=!(!p.qualities&&!f.qualities||!p.defaultQuality&&!f.defaultQuality);if(v){var d=p.originalQualities=p.originalQualities||p.qualities||f.qualities,h=p.defaultQuality||f.defaultQuality,m=p.src.replace(a,"-{q}.{ext}");"string"==typeof d&&(d=d.split(","));var q=("string"==typeof y.qualities?y.qualities.split(","):y.qualities)||d||[];qlities=[],q.forEach(function(e){qlities.push(e!==h?e:{label:e,src:m.replace(/-{q}/,"")})}),y={template:m,qualities:qlities}}if(y&&y.qualities&&y.qualities.length){p.hlsQualities=!1;var g,Q={},j=p.sources.filter(function(e){return!/mpegurl/i.test(e.type)&&t(e.type,f)})[0],b=j&&r.exec(j.src)[0],x=p.sources.some(function(e){return/mpegurl/i.test(e.type)?(Q[-1]={type:e.type,src:e.src},!0):!1});if(p.sources.forEach(function(e){e.type===c&&(g=e.src)}),(l.video||g)&&(!g||(f.rtmp||p.rtmp)&&!/^(https?:)?\/\//.test(g))){var w,S,E=x?[{value:-1,label:"Auto"}]:[],P=g&&/^(mp4|flv):/.test(g)&&g.slice(0,4)||"",O=[],k=0;if(y.qualities.forEach(function(e){"string"==typeof e?(Q[k]={type:j&&j.type,src:j&&j.type!==c?y.template.replace("{q}",e).replace(u,b):y.template.replace(n,P).replace("{q}",e).replace(u,b)},O.push({value:k,label:e})):(Q[k]={type:e.type||j&&j.type,src:e.type&&e.type!==c||j&&j.type!==c?e.src.replace(u,b):e.src.replace(n,P).replace(u,b)},O.push({value:k,label:e.label})),k++}),E=E.concat(O),p.qualities=E,w=void 0===p.vodQualitySources&&void 0!==s&&Object.keys(E).indexOf(s+"")>-1,p.vodQualitySources=Q,/mpegurl/i.test(p.type)?S=-1:Object.keys(Q).forEach(function(e){!S&&p.src.indexOf(Q[e].src)>-1&&(S=e)}),w&&s!==S){e.preventDefault(),i.loading=!1;var $=p.sources;o(p,{originalSources:$,sources:[{type:Q[s].type,src:Q[s].src}].concat($),src:null,type:null}),i.load(p)}else p.quality=S}}}}).on("quality",function(e,t,i){var l=t.video.vodQualitySources&&t.video.vodQualitySources[i];if(l){var a=t.video.originalSources||t.video.sources,r=o({},t.video,{originalSources:a,sources:[{type:l.type,src:l.src}].concat(a),src:null,type:null}),u=r.time;p&&r.hlsjs!==!1&&u&&0>i&&(r.hlsjs=o(r.hlsjs||{},{startPosition:u})),t.load(r,function(e,t){t.finished=!1,!u||r.hlsjs&&r.hlsjs.startPosition?r.hlsjs&&(r.hlsjs.startPosition=0):t.seek(u,function(){t.video.type===c&&(t.playing=!1,t.paused=!0),t.resume()}),s=i})}})}})};"object"==typeof module&&module.exports?module.exports=e:"function"==typeof window.flowplayer&&e(window.flowplayer)}();